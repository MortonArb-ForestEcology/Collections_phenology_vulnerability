# Collection phenology vulnerability
Scripts for our collection phenology vulnerability paper for the new climate change ecology special edition on phenology

# Scripts

## Arboretum

## 0_GetPhenologyList_US_Oaks

Purpose: This script serves to create a list of the oak species that we are interested in working with

Inputs: The googlesheet "Quercus Collection Metadata" 

Outputs: SpeciesList_Oak_collection_US_oaks_pheno.csv


## 1_Pull_Data_Pheno.R 

Purpose: This script serves as the initial data download and organization of the arb data

Inputs: Quercus 2018 to present phenology monitoring data from the googlesheet "Phenology_Observations_GoogleForm" in the "LivingCollections-Phenology/Data_Observations/" folder

The clean_google_form.r script which defines the clean.google function.

The group_google_form.r script which defines the group.google function.

SpeciesList_Oak_collection_US_oaks_pheno.csv
         
Outputs: Oak_collection_budburst_raw.csv

Oak_collection_leaf_raw.csv
          
Notes: Since the original raw data is kept by the authors, most users will not need to run this script. The data frames created by this script are saved in this repository and can be used for the proceeding scripts.


## 2_Pull_Data_weather.R

Purpose: This script serves as the download of weather data and the calculation of relevant weather statistics

Inputs: Oak_collection_budburst_raw.csv

        Oak_collection_leaf_raw.csv

Outputs: Arb_Daymet_clean_data.csv

Notes:  This is the script most users will start with as the pheno data is stored in this repository


## 3_Pheno_weather_match.R

Purpose: This script serves to combine our weather data with our phenometric data so we can match weather to events. Also to visualize our data since it will be our model input

Inputs:  Oak_collection_budburst_raw.csv

         Oak_collection_leaf_raw.csv

         Arb_Daymet_clean_data.csv
         
Outputs: Oak_collection_budburst.csv

         Oak_collection_leaf.csv
         
Notes:   


## 4_Pull_NPN_Data.R

Purpose: This script downloads the NPN data for our chosen oaks and cleans them

Inputs: Online NPN database
        
Outputs: CLEAN_Phenology_NPN_combined_budburst.csv

         CLEAN_Phenology_NPN_combined_leaf.csv         

Notes: 


## 5_Pull_NPN_weather.R

Purpose: This script downloads the neccessary daymet weather data to match our NPN sites

Inputs: Raw_Phenology_NPN_combined_budburst.csv
         
        Raw_Phenology_NPN_combined_leaf.csv
        
Outputs: Daymet_clean_data.csv

Notes: 


## 6_Observation_combination.R

Purpose: This script is for combining the NPN data and the ARB data into one dataframe

Inputs: Oak_collection_budburst.csv

         Oak_collection_leaf.csv
         
         Daymet_clean_data.csv
         
         Raw_Phenology_NPN_combined_budburst.csv
         
         Raw_Phenology_NPN_combined_leaf.csv

Outputs: Full_Bud_Obs.csv

         Full_Leaf_Obs.csv

Notes: I break up where we are using budburst and leaf more than in previous scripts for clarity


## 7a_Arb_TT_model.R

Purpose: This script is the ARB only model predicting the GDD5.cum value at which budburst or leaf out occur

Inputs: Full_Bud_Obs.csv

        Full_Leaf_Obs.csv
         
Outputs: ARB_TT_budburst_GelmanDiag.csv

         ARB_TT_leaf_GelmanDiag.csv
         
         ARB_TT_model_budburst.csv
         
         ARB_TT_model_leaf.csv
        
Notes: Although it uses the same data frame as an input this script doesn't use the NPN data.


## 7b_NPN_TT_model.R

Purpose: This script is the NPN and ARB model predicting the GDD5.cum value at which budburst or leaf out occur

Inputs: Full_Bud_Obs.csv

        Full_Leaf_Obs.csv
         
Outputs: COMB_TT_budburst_GelmanDiag.csv

         COMB_TT_leaf_GelmanDiag.csv
         
         COMB_TT_model_budburst.csv
         
         COMB_TT_model_leaf.csv
        
Notes: Although it uses the same data frame as an input this script doesn't use the NPN data.


## 8a_ARB_weather_match.R

Purpose: This script combines the predicted GDD5.cum for a species and matches that with a yday using daymet

Inputs: Full_Bud_Obs.csv

        Full_Leaf_Obs.csv
       
        Daymet_clean_data.csv
        
        ARB_TT_budburst_GelmanDiag.csv

        ARB_TT_leaf_GelmanDiag.csv

        ARB_TT_model_budburst.csv
         
        ARB_TT_model_leaf.csv

Outputs: ARB_TT_Budburst_Phenology_NPN_prediction.csv

         ARB_TT_Leaf_Phenology_NPN_prediction.csv

Notes: 


## 8b_NPN_weather_match.R

Purpose: This script combines the predicted GDD5.cum for a species and matches that with a yday using daymet

Inputs: Full_Bud_Obs.csv

        Full_Leaf_Obs.csv
       
        Daymet_clean_data.csv
        
        COMB_TT_budburst_GelmanDiag.csv

        COMB_TT_leaf_GelmanDiag.csv

        COMB_TT_model_budburst.csv
         
        COMB_TT_model_leaf.csv

Outputs: COMB_TT_Budburst_Phenology_NPN_prediction.csv

         COMB_TT_Leaf_Phenology_NPN_prediction.csv

Notes: 


## 9a_ARB_TT_validation.R

Purpose: This script is used to validate our ARB model predictions

Inputs: Full_Bud_Obs.csv

        Full_Leaf_Obs.csv
        
        ARB_TT_Budburst_Phenology_NPN_prediction.csv
        
        ARB_TT_Leaf_Phenology_NPN_prediction.csv
         
Outputs: ARB_TT_Budburst_Prediction_summary.csv
         
         ARB_TT_Budburst_Prediction_Evaluation_all.csv

         ARB_TT_Leaf_Prediction_summary.csv

         ARB_TT_Leaf_Prediction_Evaluation_all.csv
         
Notes:  


## 9b_ARB_TT_validation.R

Purpose: This script is used to validate our ARB + NPN model predictions

Inputs: Full_Bud_Obs.csv

        Full_Leaf_Obs.csv
        
        COMB_TT_Budburst_Phenology_NPN_prediction.csv
        
        COMB_TT_Leaf_Phenology_NPN_prediction.csv
         
Outputs: COMB_TT_Budburst_Prediction_summary.csv
         
         COMB_TT_Budburst_Prediction_Evaluation_all.csv

         COMB_TT_Leaf_Prediction_summary.csv

         COMB_TT_Leaf_Prediction_Evaluation_all.csv
         
Notes: 


## 10a_GT_model.R

Purpose: This script fits the GTmean spatial covariate model 

Inputs: Full_Bud_Obs.csv

         Full_Leaf_Obs.csv

Outputs: RevGT_budburst_GelmanDiag.csv 

         RevGT_leaf_GelmanDiag.csv
         
         RevGT_model_budburst.csv
         
         RevGT_model_leaf.csv

Notes:  


## 10b_Lat_model.R

Purpose: This script fits the latitude spatial covariate model 

Inputs:Full_Bud_Obs.csv

         Full_Leaf_Obs.csv

Outputs: RevLat_budburst_GelmanDiag.csv 

         RevLat_leaf_GelmanDiag.csv
         
         RevLat_model_budburst.csv
         
         RevLat_model_leaf.csv

Notes: 


## 11a_GT_match.R

Purpose: This script takes the predicted GDD and produces a yday prediction

Inputs: Daymet_clean_data.csv

         Full_Bud_Obs.csv
         
         RevGT_model_budburst.csv
         
         Raw_Phenology_NPN_combined_budburst.csv
         
         Full_Leaf_Obs.csv
         
         RevGT_model_leaf.csv
         
         Raw_Phenology_NPN_combined_leaf.csv

Outputs: RevGT_Budburst_Phenology_NPN_prediction.csv

RevGT_Leaf_Phenology_NPN_prediction.csv

Notes: 


## 11b_Lat_match.R

Purpose: This script takes the predicted GDD and produces a yday prediction

Inputs: Daymet_clean_data.csv

         Full_Bud_Obs.csv
         
         RevLat_model_budburst.csv
         
         Raw_Phenology_NPN_combined_budburst.csv
         
         Full_Leaf_Obs.csv
         
         RevLat_model_leaf.csv
         
         Raw_Phenology_NPN_combined_leaf.csv

Outputs: RevLat_Budburst_Phenology_NPN_prediction.csv

RevLat_Leaf_Phenology_NPN_prediction.csv

Notes: 


## 12_Bias_validaiton.R

Purpose: This script is used to check the predictions of our spatial covariate models

Inputs: Raw_Phenology_NPN_combined_budburst.csv

         Raw_Phenology_NPN_combined_leaf
         
         RevGT_Budburst_Phenology_NPN_prediction.csv
         
         RevGT_Leaf_Phenology_NPN_prediction.csv
         
         RevLat_Budburst_Phenology_NPN_prediction.csv
         
         RevLat_Leaf_Phenology_NPN_prediction.csv

Outputs: RevGT Budburst Prediction summary.csv

         RevGT_Budburst_Prediction_Evaluation_all.csv
         
         RevGT Leaf Prediction summary.csv
         
         RevGT_Leaf_Prediction_Evaluation_all.csv
         
         RevLat Budburst Prediction summary.csv
         
         RevLat_Budburst_Prediction_Evaluation_all.csv
         
         RevLat Leaf Prediction summary.csv
         
         RevLat_Leaf_Prediction_Evaluation_all.csv

Notes: This script needs new model names manually added


## 13_Bias_model_comparison.R

Purpose: This script creates dataframees and figures comparing our different bias correction models

Inputs: Null GDD Model output from script 8

         First_Budburst_Prediction_Evaluation_all.csv
         
         RevLat_Budburst_Prediction_Evaluation_all.csv
         
         RevGT_Budburst_Prediction_Evaluation_all.csv
         
         First_Leaf_Prediction_Evaluation_all.csv
         
         RevLat_Leaf_Prediction_Evaluation_all.csv
         
         RevGT_Leaf_Prediction_Evaluation_all.csv

Outputs: Four major figures for our paper and 5 major tables for our paper

Notes: 


# Functions

## clean_google.R

Purpose: A function that will reformat our googlesheets into a useful data format

Inputs: 2018 to present phenology monitoring data from the googlesheet "Phenology_Observations_GoogleForm" 
            
Outputs: A reformatted version of our googlesheet data that is easier to work with


## group_google.R

Purpose: A function that will download all of the google forms of interest

Inputs: 2018 to present phenology monitoring data from the googlesheet "Phenology_Observations_GoogleForm" 

The clean_google_form.r script which defines the clean.google function
        
Outputs: A dataframe containing the information from all desired google forms.


## weather_calc.R

Purpose: This function serves to calculate weather statistics of interest. 

Currently Growing degree days at 5C, Growing degree days at 0C, Number of chill days, and Growing season mean temperature
         
Inputs: Lubridate package

Outputs:This function will take a data frame of daily weather data and produce the following summary statistics

GDD5 = Growing degree days at 5 degrees C 

GDD0 = Growing degree days at 0 degrees C

NCD = Number of chilling days 

GTmean = Growing season mean temperature

PTTGDD = Growing degree day at 5 degrees C * the amount of light per day
  
Notes: The defaults for this funcion are

Starting year of interest                       y_start = 1975

Ending year of interest                         y_end = 2019

Julian yday for start of growing season         g_start = 1

Julian yday for end of growing season           g_end = 90

