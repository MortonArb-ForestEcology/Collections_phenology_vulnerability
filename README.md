# Collection phenology vulnerability
Scripts for our collection phenology vulnerability paper for the new climate change ecology special edition on phenology

# Scripts

## Arboretum

## 0_GetPhenologyList_US_Oaks

Purpose: This script serves to create a list of the oak species that we are interested in working with

Inputs: The googlesheet "Quercus Collection Metadata" 

Outputs: dat.oak dataframe that contains the names of the species of interest


## 1_Pull_Data_Pheno.R 

Purpose: This script serves as the initial data download and organization of the arb data

Inputs: Quercus 2018 to present phenology monitoring data from the googlesheet "Phenology_Observations_GoogleForm" in the "LivingCollections-Phenology/Data_Observations/" folder

The clean_google_form.r script which defines the clean.google function.

The group_google_form.r script which defines the group.google function
         
Outputs: dat.burst dataframe that can be used for the model

dat.leaf dataframe that can be used for the model
          
Notes: Since the original raw data is kept by the authors, most users will not need to run this script. The data frames created by this script are saved in this repository and can be used for the proceeding scripts.


## 2_Pull_Data_weather.R

Purpose: This script serves as the download of weather data and the calculation of relevant weather statistics

Inputs: The weather_calc.r script which defines the weather_calc function.

Outputs: met.all dataframe that can be used to match weather to phenological events

Notes:  This is the script most users will start with as the pheno data is stored in this repository


## 3_Pheno_weather_match.R

Purpose: This script serves to combine our weather data with our phenometric data so we can match weather to events. Also to visualize our data since it will be our model input

Inputs:  Oak_collection_budburst_raw.csv

Oak_collection_leaf_raw.csv

Daymet_Clean_data.csv
         
Outputs: dat.budburst data frame containing first budburst event and weather statistics of interest

dat.leaf data frame containing first budburst event and weather statistics of interest
         
Notes:   


## 4_Thermal_Time_model.R

Purpose: This script is the model predicting the GDD5.cum value at which budburst or leaf out occur

Inputs: Oak_collection_budburst.csv

Oak_collection_leaf.csv
         
Outputs: Posterior distributions for bud burst and leaf out for every species in our collection

A data.frame with information on the model run to check convergence  
        
Notes: This script can be made into a loop for each species but is currently manual to allow for checks as it runs


## 5_Model_visualization.R

Purpose: This script combines the posterior distributions of all species so we can look at them as a group

Inputs: Model outputs for all species in the oak collection for budburst and leaf out

Processed leaf and budburst phenology data frame made by script 3

Outputs: Various figures and summary statistics

Notes: I break up where we are using budburst and leaf more than in previous scripts for clarity


## 6_Pull_NPN_Data.R

Purpose: This script downloads the NPN data for our chosen oaks and cleans them

Inputs: Arb budburst data frame as made by script 3

Arb leaf out data frame as made by script 3
        
Outputs: Data frame containing all NPN data for our oak species

Notes: 

## 7_Pull_NPN_Data.R

Purpose: This script downloads the neccessary daymet weather data to match our NPN sites

Inputs: NPN data for relevant species as downloaded in script 6

Outputs: Data frame containing all weather data needed for npn sites

Notes: This script takes nearly an hour to run because of the size of the data

## 8_NPN_weather_match.R

Purpose: This script downloads the neccessary daymet weather data to match our NPN sites

Inputs: NPN data for relevant species as downloaded in script 6

Daymet data for NPN sites as downloaded in script 7
        
Outputs: Data frame matching the weather with the sites

Notes: 

## 9_NPN_validation.R

Purpose: This script downloads the neccessary daymet weather data to match our NPN sites

Inputs: Budburst data frame with weather metrics as created by script 8

Leaf out data frame with weather metrics as created by script 8 

Outputs:Validation data frames needed to fit the bias correction models 
        
Tables containing summary statistics of the GDD5.cum Thresholds for each species and site
        
Notes: This scripts creates the neccessary data for the model to fit it's bias correction 
       
This script only needs to have it's first half run as the rest is visualizations 

## 10a_GTmean_model.R

Purpose: This script fits the GTmean spatial bias model 

Inputs: Budburst data frame with residuals created by script 9

Leaf out data frame with residuals created by script 9 

Outputs: GTmean Model output of fit bias correction

Notes: 

## 10b_Rel_GTmean_model.R

Purpose: This script fits the relative GTmean spatial bias model 

Inputs: Budburst data frame with residuals created by script 9

Leaf out data frame with residuals created by script 9 

Arboretum weather data created by script 2 (Also stored in the repository)

Outputs: Relative GTmean Model output of fit bias correction

Notes: 

## 10c_Rel_Lat_model.R

Purpose: This script fits the relative latitude spatial bias model 

Inputs: Budburst data frame with residuals created by script 9

Leaf out data frame with residuals created by script 9 

Outputs: Relative Latitude Model output of fit bias correction

Notes: 

## 11a_GTmean_match.R

Purpose: This script combines the predicted Yday for a species and then acounts for bias

Inputs: NPN data for relevant species as downloaded in script 6

Daymet data for NPN sites as downloaded in script 7

Model output from the GTmean model

Outputs: Data frame matching the observations with their bias corrected prediction

Notes: 

## 11b_Rel_GTmean_match.R

Purpose: This script combines the predicted Yday for a species and then acounts for bias

Inputs: NPN data for relevant species as downloaded in script 6

Daymet data for NPN sites as downloaded in script 7

Model output from the Relative GTmean model

Outputs: Data frame matching the observations with their bias corrected prediction

Notes: 

## 11c_Rel_Lat_match.R

Purpose: This script combines the predicted Yday for a species and then acounts for bias

Inputs: NPN data for relevant species as downloaded in script 6

Daymet data for NPN sites as downloaded in script 7

Model output from the Relative Latitude model

Outputs: Data frame matching the observations with their bias corrected prediction

Notes: 

## 12_Bias_validaiton.R

Purpose: This script is used to validate our GTmean model

Inputs: Prediction dataframes made by the 10_model_match.R scripts

NPN data of interest to validate with our predicitons

Outputs:Validation data frames to be epxplored in the Bias_model_comparison script

Notes: This script needs new model names manually added

## 13_Bias_model_comparison.R

Purpose: This script creates dataframees and figures comparing our different bias correction models

Inputs: The original non-bias corrected model output created by script 4

All of the bias corrected model outputs created by their various scripts

Currently:  Relative latitude, Growing season mean, and Relative growing season mean

Outputs: Visulizations and dataframes comparing our different models to the null

Notes: 

# Functions

## clean_google.R

Purpose: A function that will reformat our googlesheets into a useful data format

Inputs: 2018 to present phenology monitoring data from the googlesheet "Phenology_Observations_GoogleForm" 
            
Outputs: A reformatted version of our googlesheet data that is easier to work with


## group_google.R

Purpose: A function that will download all of the google forms of interest

Inputs: 2018 to present phenology monitoring data from the googlesheet "Phenology_Observations_GoogleForm" 

The clean_google_form.r script which defines the clean.google function
        
Outputs: A dataframe containing the information from all desired google forms.

## weather_calc.R

Purpose: This function serves to calculate weather statistics of interest. 

Currently Growing degree days at 5C, Growing degree days at 0C, Number of chill days, and Growing season mean temperature
         
Inputs: Lubridate package

Outputs:This function will take a data frame of daily weather data and produce the following summary statistics

GDD5 = Growing degree days at 5 degrees C 

GDD0 = Growing degree days at 0 degrees C

NCD = Number of chilling days 

GTmean = Growing season mean temperature

PTTGDD = Growing degree day at 5 degrees C * the amount of light per day
  
Notes: The defaults for this funcion are

Starting year of interest                       y_start = 1975

Ending year of interest                         y_end = 2019

Julian yday for start of growing season         g_start = 1

Julian yday for end of growing season           g_end = 90

