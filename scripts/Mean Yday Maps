#Creating a map of the average budburst and leafout Yday at each site
#You can follow this script or skip to the plot generation section if you have already run script 9 from the repository

library(ggplot2)

#Reading in our cleaned NPN data
dat.budburst <- read.csv("../Raw_Phenology_NPN_combined_budburst.csv")

#Putting a filter on reports after August 1st since we are interested in spring phenology
dat.budburst <- dat.budburst[dat.budburst$Yday < 213,]

#Establishing a folder path for our figures
path.figures <- ".."

#Grouping the dat.budburst df by site_id and averaging the values of each row
mean.bud <- dat.budburst %>% group_by(site_id) %>% mutate_each(funs(mean)) %>% distinct

#Mean Budburst Date Map
map.us <- map_data("state")
png(paste0(path.figures, "Mean Budburst Map.png", sep=""), height=6, width=8, units="in", res=180)
ggplot() +
  coord_fixed(1.3) +
  ggtitle(paste("Mean NPN Site Quercus Budburst", sep=" ")) +
  geom_polygon(data=map.us, aes(x=long, y=lat, group=group), fill=NA, color="black") +
  geom_point(data=mean.bud, aes(x=longitude, y=latitude, color=Yday), alpha=.75) +
  #facet_wrap(~species)+
  scale_color_continuous(type = "viridis", option = "C") +
  scale_size_continuous()+
  labs(color = "Mean Yday",size="Number of Observations") +
  theme(panel.background = element_blank(),
        panel.grid = element_blank(),
        axis.text=element_blank(),
        axis.title=element_blank(),
        axis.ticks = element_blank())
dev.off()

#Repeating for leafout data

dat.leaf <- read.csv("../Raw_Phenology_NPN_combined_leaf.csv")

dat.leaf <- dat.leaf[dat.leaf$Yday < 213,]

mean.leaf <- dat.leaf %>% group_by(site_id) %>% mutate_each(funs(mean)) %>% distinct

#Mean Leafout Date Map
map.us <- map_data("state")
png(paste0(path.figures, "Mean Leafout Map.png", sep=""), height=6, width=8, units="in", res=180)
ggplot() +
  coord_fixed(1.3) +
  ggtitle(paste("Mean NPN Site Quercus Leafout", sep=" ")) +
  geom_polygon(data=map.us, aes(x=long, y=lat, group=group), fill=NA, color="black") +
  geom_point(data=mean.leaf, aes(x=longitude, y=latitude, color=Yday), alpha=.75) +
  facet_wrap(~species)+
  scale_color_continuous(type = "viridis", option = "C") +
  scale_size_continuous()+
  labs(color = "Mean Yday",size="Number of Observations") +
  theme(panel.background = element_blank(),
        panel.grid = element_blank(),
        axis.text=element_blank(),
        axis.title=element_blank(),
        axis.ticks = element_blank())
dev.off()
