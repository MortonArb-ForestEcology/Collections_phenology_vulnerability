#Plots that combine species trends into one plot.
#First, run script 13 to create the first, GT, RGT, and Rlat. dataframes.

#Using the first.comb dataframes

#Creating a new df that adds a 'predicted - observed' column from the first.comb.burst and first.comb.leaf dataframes
#pmo stands for predicted minus observed

first.bud.pmo <- mutate(first.comb.burst, "predicted.minus.observed" = mid - Yday)

first.leaf.pmo <- mutate(first.comb.leaf, "predicted.minus.observed" = mid - Yday)

path.figures <- ".."

#Bud Predicted - Observed vs. Latitude Combined
png(width = 800, filename= file.path(path.figures, paste0('First Bud Predicted - Observed', '.png')))
ggplot(first.bud.pmo, aes(x = latitude, y = predicted.minus.observed, color = species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  ggtitle('first.comb.burst Predicted Minus Observed vs Latitude') +
  xlab("Latitude")+
  ylab("Predicted - Observed")
dev.off()

#Leaf Predicted - Observed vs Latitude Combined
png(width = 800, filename= file.path(path.figures, paste0('First Leaf Predicted - Observed', '.png')))
ggplot(first.leaf.pmo, aes(x = latitude, y = predicted.minus.observed, color = species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  ggtitle('first.comb.leaf Predicted Minus Observed vs Latitude') +
  xlab("Latitude")+
  ylab("Predicted - Observed")
dev.off()

#Bud Predicted - Observed vs. Observed
png(width = 800, filename= file.path(path.figures, paste0('First Bud Predicted - Observed vs Observed', '.png')))
ggplot(first.bud.pmo, aes(x = Yday, y = predicted.minus.observed, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  #facet_wrap(~species) + #add this to group plots by individual species (not combined)
  xlim(0, 220)+ylim(-100, 50)+
  ggtitle('first.comb.burst Predicted Minus Observed vs Observed') +
  xlab("Observed Yday")+
  ylab("Predicted - Observed")
dev.off()

#Leaf Predicted - Observed vs. Observed
png(width = 800, filename= file.path(path.figures, paste0('First Leaf Predicted - Observed vs Observed', '.png')))
ggplot(first.leaf.pmo, aes(x = Yday, y = predicted.minus.observed, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  #facet_wrap(~species) + #add this to group plots by individual species (not combined)
  xlim(0, 220)+ylim(-100, 50)+
  ggtitle('first.comb.leaf Predicted Minus Observed vs Observed') +
  xlab("Observed Yday")+
  ylab("Predicted - Observed")
dev.off()

#Bud Predicted vs. Observed Combined 
png(width = 800, filename= file.path(path.figures, paste0('First Bud NPN Validation', '.png')))
ggplot(first.comb.burst, aes(x = Yday, y = mid, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  geom_abline(intercept = 0, slope = 1)+
  ggtitle('first.comb.burst NPN Validation') +
  xlab("Observed Yday")+
  ylab("Predicted Yday")
dev.off()

#Leaf Predicted vs. Observed Combined 
png(width = 800, filename= file.path(path.figures, paste0('First Leaf NPN Validation', '.png')))
ggplot(first.comb.leaf, aes(x = Yday, y = mid, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  geom_abline(intercept = 0, slope = 1)+
  ggtitle('first.comb.leaf NPN Validation') +
  xlab("Observed Yday")+
  ylab("Predicted Yday")
dev.off()


#------------------------------------------------------------------------------------------------#

#Using the GT.comb dataframes

#Creating a new df that adds a 'predicted - observed' column from the GT.comb.burst and GT.comb.leaf dataframes

GT.bud.pmo <- mutate(GT.comb.burst, "predicted.minus.observed" = mid - Yday)

GT.leaf.pmo <- mutate(GT.comb.leaf, "predicted.minus.observed" = mid - Yday)

path.figures <- ".."

#Bud Predicted - Observed vs. Latitude Combined
png(width = 800, filename= file.path(path.figures, paste0('GT Bud Predicted - Observed', '.png')))
ggplot(GT.bud.pmo, aes(x = latitude, y = predicted.minus.observed, color = species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  ggtitle('GT.comb.burst Predicted Minus Observed vs Latitude') +
  xlab("Latitude")+
  ylab("Predicted - Observed")
dev.off()

#Leaf Predicted - Observed vs Latitude Combined
png(width = 800, filename= file.path(path.figures, paste0('GT Leaf Predicted - Observed', '.png')))
ggplot(GT.leaf.pmo, aes(x = latitude, y = predicted.minus.observed, color = species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  ggtitle('GT.comb.leaf Predicted Minus Observed vs Latitude') +
  xlab("Latitude")+
  ylab("Predicted - Observed")
dev.off()

#Bud Predicted - Observed vs. Observed
png(width = 800, filename= file.path(path.figures, paste0('GT Bud Predicted - Observed vs Observed', '.png')))
ggplot(GT.bud.pmo, aes(x = Yday, y = predicted.minus.observed, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  #facet_wrap(~species) + #add this to group plots by individual species (not combined)
  xlim(0, 220)+ylim(-100, 50)+
  ggtitle('GT.comb.burst Predicted Minus Observed vs Observed') +
  xlab("Observed Yday")+
  ylab("Predicted - Observed")
dev.off()

#Leaf Predicted - Observed vs. Observed
png(width = 800, filename= file.path(path.figures, paste0('GT Leaf Predicted - Observed vs Observed', '.png')))
ggplot(GT.leaf.pmo, aes(x = Yday, y = predicted.minus.observed, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  #facet_wrap(~species) + #add this to group plots by individual species (not combined)
  xlim(0, 220)+ylim(-100, 50)+
  ggtitle('GT.comb.leaf Predicted Minus Observed vs Observed') +
  xlab("Observed Yday")+
  ylab("Predicted - Observed")
dev.off()

#Bud Predicted vs. Observed Combined 
png(width = 800, filename= file.path(path.figures, paste0('GT Bud NPN Validation', '.png')))
ggplot(GT.comb.burst, aes(x = Yday, y = mid, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  geom_abline(intercept = 0, slope = 1)+
  ggtitle('GT.comb.burst NPN Validation') +
  xlab("Observed Yday")+
  ylab("Predicted Yday")
dev.off()

#Leaf Predicted vs. Observed Combined 
png(width = 800, filename= file.path(path.figures, paste0('GT Leaf NPN Validation', '.png')))
ggplot(GT.comb.leaf, aes(x = Yday, y = mid, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  geom_abline(intercept = 0, slope = 1)+
  ggtitle('GT.comb.leaf NPN Validation') +
  xlab("Observed Yday")+
  ylab("Predicted Yday")
dev.off()


#------------------------------------------------------------------------------------------------#

#Using the RGT.comb dataframes

#Creating a new df that adds a 'predicted - observed' column from the RGT.comb.burst and RGT.comb.burst dataframes

RGT.bud.pmo <- mutate(RGT.comb.burst, "predicted.minus.observed" = mid - Yday)

RGT.leaf.pmo <- mutate(RGT.comb.leaf, "predicted.minus.observed" = mid - Yday)

path.figures <- ".."

#Bud Predicted - Observed vs. Latitude Combined
png(width = 800, filename= file.path(path.figures, paste0('RGT Bud Predicted - Observed', '.png')))
ggplot(RGT.bud.pmo, aes(x = latitude, y = predicted.minus.observed, color = species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  ggtitle('RGT.comb.burst Predicted Minus Observed vs Latitude') +
  xlab("Latitude")+
  ylab("Predicted - Observed")
dev.off()

#Leaf Predicted - Observed vs Latitude Combined
png(width = 800, filename= file.path(path.figures, paste0('RGT Leaf Predicted - Observed', '.png')))
ggplot(RGT.leaf.pmo, aes(x = latitude, y = predicted.minus.observed, color = species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  ggtitle('RGT.comb.leaf Predicted Minus Observed vs Latitude') +
  xlab("Latitude")+
  ylab("Predicted - Observed")
dev.off()

#Bud Predicted - Observed vs. Observed
png(width = 800, filename= file.path(path.figures, paste0('RGT Bud Predicted - Observed vs Observed', '.png')))
ggplot(RGT.bud.pmo, aes(x = Yday, y = predicted.minus.observed, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  #facet_wrap(~species) + #add this to group plots by individual species (not combined)
  xlim(0, 220)+ylim(-100, 50)+
  ggtitle('RGT.comb.burst Predicted Minus Observed vs Observed') +
  xlab("Observed Yday")+
  ylab("Predicted - Observed")
dev.off()

#Leaf Predicted - Observed vs. Observed
png(width = 800, filename= file.path(path.figures, paste0('RGT Leaf Predicted - Observed vs Observed', '.png')))
ggplot(RGT.leaf.pmo, aes(x = Yday, y = predicted.minus.observed, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  #facet_wrap(~species) + #add this to group plots by individual species (not combined)
  xlim(0, 220)+ylim(-100, 50)+
  ggtitle('RGT.comb.leaf Predicted Minus Observed vs Observed') +
  xlab("Observed Yday")+
  ylab("Predicted - Observed")
dev.off()

#Bud Predicted vs. Observed Combined 
png(width = 800, filename= file.path(path.figures, paste0('RGT Bud NPN Validation', '.png')))
ggplot(RGT.comb.burst, aes(x = Yday, y = mid, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  geom_abline(intercept = 0, slope = 1)+
  ggtitle('RGT.comb.burst NPN Validation') +
  xlab("Observed Yday")+
  ylab("Predicted Yday")
dev.off()

#Leaf Predicted vs. Observed Combined 
png(width = 800, filename= file.path(path.figures, paste0('RGT Leaf NPN Validation', '.png')))
ggplot(RGT.comb.leaf, aes(x = Yday, y = mid, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  geom_abline(intercept = 0, slope = 1)+
  ggtitle('RGT.comb.leaf NPN Validation') +
  xlab("Observed Yday")+
  ylab("Predicted Yday")
dev.off()


#-------------------------------------------------------------------------------------------------#

#Using the Rlat dataframes

#Creating a new df that adds a 'predicted - observed' column from the Rlat.comb.burst and Rlat.comb.leaf dataframes

Rlat.bud.pmo <- mutate(Rlat.comb.burst, "predicted.minus.observed" = mid - Yday)

Rlat.leaf.pmo <- mutate(Rlat.comb.leaf, "predicted.minus.observed" = mid - Yday)

path.figures <- ".."

#Bud Predicted - Observed vs. Latitude Combined
png(width = 800, filename= file.path(path.figures, paste0('Rlat Bud Predicted - Observed', '.png')))
ggplot(Rlat.bud.pmo, aes(x = latitude, y = predicted.minus.observed, color = species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  ggtitle('Rlat.comb.burst Predicted Minus Observed vs Latitude') +
  xlab("Latitude")+
  ylab("Predicted - Observed")
dev.off()

#Leaf Predicted - Observed vs Latitude Combined
png(width = 800, filename= file.path(path.figures, paste0('Rlat Leaf Predicted - Observed', '.png')))
ggplot(Rlat.leaf.pmo, aes(x = latitude, y = predicted.minus.observed, color = species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  ggtitle('Rlat.comb.leaf Predicted Minus Observed vs Latitude') +
  xlab("Latitude")+
  ylab("Predicted - Observed")
dev.off()

#Bud Predicted - Observed vs. Observed
png(width = 800, filename= file.path(path.figures, paste0('Rlat Bud Predicted - Observed vs Observed', '.png')))
ggplot(Rlat.bud.pmo, aes(x = Yday, y = predicted.minus.observed, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  #facet_wrap(~species) + #add this to group plots by individual species (not combined)
  xlim(0, 220)+ylim(-100, 50)+
  ggtitle('Rlat.comb.burst Predicted Minus Observed vs Observed') +
  xlab("Observed Yday")+
  ylab("Predicted - Observed")
dev.off()

#Leaf Predicted - Observed vs. Observed
png(width = 800, filename= file.path(path.figures, paste0('Rlat Leaf Predicted - Observed vs Observed', '.png')))
ggplot(Rlat.leaf.pmo, aes(x = Yday, y = predicted.minus.observed, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  #facet_wrap(~species) + #add this to group plots by individual species (not combined)
  xlim(0, 220)+ylim(-100, 50)+
  ggtitle('Rlat.comb.leaf Predicted Minus Observed vs Observed') +
  xlab("Observed Yday")+
  ylab("Predicted - Observed")
dev.off()

#Bud Predicted vs. Observed Combined 
png(width = 800, filename= file.path(path.figures, paste0('Rlat Bud NPN Validation', '.png')))
ggplot(Rlat.comb.burst, aes(x = Yday, y = mid, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  geom_abline(intercept = 0, slope = 1)+
  ggtitle('Rlat.comb.burst NPN Validation') +
  xlab("Observed Yday")+
  ylab("Predicted Yday")
dev.off()

#Leaf Predicted vs. Observed Combined 
png(width = 800, filename= file.path(path.figures, paste0('Rlat Leaf NPN Validation', '.png')))
ggplot(Rlat.comb.leaf, aes(x = Yday, y = mid, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  geom_abline(intercept = 0, slope = 1)+
  ggtitle('Rlat.comb.leaf NPN Validation') +
  xlab("Observed Yday")+
  ylab("Predicted Yday")
dev.off()

#------------------------------------------------------------------------------------------------#
#Using the Lat dataframes

#Creating a new df that adds a 'predicted - observed' column from the lat.comb.burst and lat.comb.leaf dataframes

Lat.bud.pmo <- mutate(Lat.comb.burst, "predicted.minus.observed" = mid - Yday)

Lat.leaf.pmo <- mutate(Lat.comb.leaf, "predicted.minus.observed" = mid - Yday)

path.figures <- ".."

#Bud Predicted - Observed vs. Latitude Combined
png(width = 800, filename= file.path(path.figures, paste0('Lat Bud Predicted - Observed', '.png')))
ggplot(Lat.bud.pmo, aes(x = latitude, y = predicted.minus.observed, color = species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  ggtitle('Lat.comb.burst Predicted Minus Observed vs Latitude') +
  xlab("Latitude")+
  ylab("Predicted - Observed")
dev.off()

#Leaf Predicted - Observed vs Latitude Combined
png(width = 800, filename= file.path(path.figures, paste0('Lat Leaf Predicted - Observed', '.png')))
ggplot(Lat.leaf.pmo, aes(x = latitude, y = predicted.minus.observed, color = species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  ggtitle('Lat.comb.leaf Predicted Minus Observed vs Latitude') +
  xlab("Latitude")+
  ylab("Predicted - Observed")
dev.off()

#Bud Predicted - Observed vs. Observed
png(width = 800, filename= file.path(path.figures, paste0('Lat Bud Predicted - Observed vs Observed', '.png')))
ggplot(Lat.bud.pmo, aes(x = Yday, y = predicted.minus.observed, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  #facet_wrap(~species) + #add this to group plots by individual species (not combined)
  xlim(0, 220)+ylim(-100, 50)+
  ggtitle('Lat.comb.burst Predicted Minus Observed vs Observed') +
  xlab("Observed Yday")+
  ylab("Predicted - Observed")
dev.off()

#Leaf Predicted - Observed vs. Observed
png(width = 800, filename= file.path(path.figures, paste0('Lat Leaf Predicted - Observed vs Observed', '.png')))
ggplot(Lat.leaf.pmo, aes(x = Yday, y = predicted.minus.observed, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  #facet_wrap(~species) + #add this to group plots by individual species (not combined)
  xlim(0, 220)+ylim(-100, 50)+
  ggtitle('Lat.comb.leaf Predicted Minus Observed vs Observed') +
  xlab("Observed Yday")+
  ylab("Predicted - Observed")
dev.off()

#Bud Predicted vs. Observed Combined 
png(width = 800, filename= file.path(path.figures, paste0('Lat Bud NPN Validation', '.png')))
ggplot(Lat.comb.burst, aes(x = Yday, y = mid, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  geom_abline(intercept = 0, slope = 1)+
  ggtitle('Lat.comb.burst NPN Validation') +
  xlab("Observed Yday")+
  ylab("Predicted Yday")
dev.off()

#Leaf Predicted vs. Observed Combined 
png(width = 800, filename= file.path(path.figures, paste0('Lat Leaf NPN Validation', '.png')))
ggplot(Lat.comb.leaf, aes(x = Yday, y = mid, color=species))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  geom_abline(intercept = 0, slope = 1)+
  ggtitle('Lat.comb.leaf NPN Validation') +
  xlab("Observed Yday")+
  ylab("Predicted Yday")
dev.off()
#-------------------------------------------------------------------------------------------------#

#Start of Model Comparison Figures for Budburst

#modifying the dataframes to contain only the columns we need (mid and Yday) and creating a new column which names the model

new.first.burst <- first.bud.pmo %>% select(species, latitude, Yday, mid, predicted.minus.observed) %>% mutate(model="first")
new.GT.burst <- GT.bud.pmo %>% select(species, latitude, Yday, mid, predicted.minus.observed) %>% mutate(model="GT")
new.RGT.burst <- RGT.bud.pmo %>% select(species, latitude, Yday, mid, predicted.minus.observed) %>% mutate(model="RGT")
new.Rlat.burst <- Rlat.bud.pmo %>% select(species, latitude, Yday, mid, predicted.minus.observed) %>% mutate(model="Rlat")
new.Lat.burst <-  Lat.bud.pmo %>% select(species, latitude, Yday, mid, predicted.minus.observed) %>% mutate(model="Lat")

#Creating a new data frame combining each model

model.comb.burst <- rbind(new.first.burst, new.GT.burst, new.RGT.burst, new.Rlat.burst, new.Lat.burst)

#Bud Predicted vs Observed
png(width = 800, filename= file.path(path.figures, paste0('Mod Comp Bud NPN Validation', '.png')))
ggplot(model.comb.burst, aes(x = Yday, y = mid, color = model))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  facet_wrap(~species) +
  geom_abline(intercept = 0, slope = 1)+
  ggtitle('Model Comparison Budburst NPN Validation') +
  xlab("Observed Yday")+
  ylab("Predicted Yday")
dev.off()

#Predicted - Observed
png(width = 800, filename= file.path(path.figures, paste0('Mod Comp Bud Predicted - Observed', '.png')))
ggplot(model.comb.burst, aes(x = latitude, y = predicted.minus.observed, color = model))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  facet_wrap(~species) +
  ggtitle('Model Comparison Budburst Predicted Minus Observed vs Latitude') +
  xlab("Latitude")+
  ylab("Predicted - Observed")
dev.off()

#Predicted - Observed vs. Observed
png(width = 800, filename= file.path(path.figures, paste0('Mod Comp Bud Predicted - Observed vs Observed', '.png')))
ggplot(model.comb.burst, aes(x = Yday, y = predicted.minus.observed, color=model))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  facet_wrap(~species) +
  #xlim(0, 220)+ylim(-100, 50)+
  ggtitle('Model Comparison Budburst Predicted Minus Observed vs Observed') +
  xlab("Observed Yday")+
  ylab("Predicted - Observed")
dev.off()


#------------------------------------------------------------------------------------------------#

#Leaf section

#modifying the dataframes to contain only the columns we need (mid and Yday) and creating a new column which names the model

new.first.leaf <- first.leaf.pmo %>% select(species, latitude, Yday, mid, predicted.minus.observed) %>% mutate(model="first")
new.GT.leaf <- GT.leaf.pmo %>% select(species, latitude, Yday, mid, predicted.minus.observed) %>% mutate(model="GT")
new.RGT.leaf <- RGT.leaf.pmo %>% select(species, latitude, Yday, mid, predicted.minus.observed) %>% mutate(model="RGT")
new.Rlat.leaf <- Rlat.leaf.pmo %>% select(species, latitude, Yday, mid, predicted.minus.observed) %>% mutate(model="Rlat")
new.Lat.leaf <- Lat.leaf.pmo %>% select(species, latitude, Yday, mid, predicted.minus.observed) %>% mutate(model="Lat")

#Creating a new data frame combining each model

model.comb.leaf <- rbind(new.first.leaf, new.GT.leaf, new.RGT.leaf, new.Rlat.leaf, new.Lat.leaf)

#leaf Predicted vs Observed
png(width = 800, filename= file.path(path.figures, paste0('Mod Comp Leaf NPN Validation', '.png')))
ggplot(model.comb.leaf, aes(x = Yday, y = mid, color = model))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  facet_wrap(~species) +
  geom_abline(intercept = 0, slope = 1)+
  ggtitle('Model Comparison Leafout NPN Validation') +
  xlab("Observed Yday")+
  ylab("Predicted Yday")
dev.off()

#Predicted - Observed
png(width = 800, filename= file.path(path.figures, paste0('Mod Comp Leaf Predicted - Observed', '.png')))
ggplot(model.comb.leaf, aes(x = latitude, y = predicted.minus.observed, color = model))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  facet_wrap(~species) +
  ggtitle('Model Comparison Leafout Predicted Minus Observed vs Latitude') +
  xlab("Latitude")+
  ylab("Predicted - Observed")
dev.off()

#Predicted - Observed vs. Observed
png(width = 800, filename= file.path(path.figures, paste0('Mod Comp Leaf Predicted - Observed vs Observed', '.png')))
ggplot(model.comb.leaf, aes(x = Yday, y = predicted.minus.observed, color=model))+
  geom_smooth(method='lm', se = FALSE, linetype = "dashed")+
  facet_wrap(~species) +
  #xlim(0, 220)+ylim(-100, 50)+
  ggtitle('Model Comparison Leafout Predicted Minus Observed vs Observed') +
  xlab("Observed Yday")+
  ylab("Predicted - Observed")
dev.off()
