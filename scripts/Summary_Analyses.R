# Doing some summary analyses to help provide analyses, particularly with latitudinal trends that support manuscript text
# Table of Script Contents
# 1. Analysis of latitudinal trends in budburst and leaf out
#    1.a. Null GDD model
#    1.b. Latitude adjustment  (lat)
#    1.c. Growing Season Temp Adjustment (GT)
#    1.d. RelLat (RLAT)
#    1.e. RelGT  (RGT)

path.data <- "../data_processed" 
path.figures <- "../figures_final"
path.hub <- "../data"


# ---------------------------------
# Analysis of latitude trends in budburst
# ---------------------------------
bud.gdd <- read.csv(file.path(path.data, 'First_Budburst_Prediction_Evaluation_all.csv'), stringsAsFactors = T)
leaf.gdd <- read.csv(file.path(path.data, 'First_Leaf_Prediction_Evaluation_all.csv'), stringsAsFactors = T)
bud.lat <- read.csv("../data_processed/Leaf_Prediction_Evaluation_all.csv")
leaf.lat
bud.gt
leaf.gt
bud.rlat
leaf.rlat
bud.rgt
leaf.rgt 

# Simple but statistically inappropriate way of analyzing because ignores dataset structural dependencies (but useful for getting rough idea of patterns)
bud.lat.lm <- lm(diff ~ latitude*species - latitude - 1, data=bud.eval)

summary(bud.lat.lm)
anova(bud.lat.lm)


# The linear mixed model with random effects is more appropriate, but since we only ahve 1 site for marilandica, we need to omit it from the analysis
library(nlme)
bud.lat <- lme(diff ~ latitude*species - latitude - 1, random=list(site_id=~1, individual_id=~1), data=bud.eval[!bud.eval$species %in% "marilandica",], na.action=na.omit)
summary(bud.lat)

bud.lat.sumstat <- data.frame(summary(bud.lat)$tTable)
bud.lat.sumstat$Value <- round(bud.lat.sumstat$Value, 1)
bud.lat.sumstat$Std.Error <- round(bud.lat.sumstat$Std.Error, 1)
bud.lat.sumstat$t.value <- round(bud.lat.sumstat$t.value, 1)
bud.lat.sumstat$p.value <- round(bud.lat.sumstat$p.value, 3)
bud.lat.sumstat

write.csv(bud.lat.sumstat, "../data_processed/LatitudeTrends_Budburst_LME_outputput_First.csv", row.names=T)


leaf.lat.lm <- lm(diff ~ latitude*species - latitude - 1, data=leaf.eval)

summary(leaf.lat.lm)
anova(leaf.lat.lm)

leaf.lat <- lme(diff ~ latitude*species - latitude - 1, random=list(site_id=~1, individual_id=~1), data=leaf.eval[!leaf.eval$species %in% "marilandica",], na.action=na.omit)
summary(bud.lat)

leaf.lat.sumstat <- data.frame(summary(leaf.lat)$tTable)
leaf.lat.sumstat$Value <- round(leaf.lat.sumstat$Value, 1)
leaf.lat.sumstat$Std.Error <- round(leaf.lat.sumstat$Std.Error, 1)
leaf.lat.sumstat$t.value <- round(leaf.lat.sumstat$t.value, 1)
leaf.lat.sumstat$p.value <- round(leaf.lat.sumstat$p.value, 3)
leaf.lat.sumstat

write.csv(leaf.lat.sumstat, "../data_processed/LatitudeTrends_Leafout_LME_outputput_First.csv", row.names=T)

# Evaluating change in slope with the different adjusted 
# # NOTE: need to repeat the Evaluation process for each of the models
# dir(path.data, "Evaluation")
