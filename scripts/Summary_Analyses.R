# Doing some summary analyses to help provide analyses, particularly with latitudinal trends that support manuscript text
# Table of Script Contents
# 1. Analysis of latitudinal trends in budburst and leaf out
#    1.a. Null GDD model
#    1.b. Latitude adjustment  (lat)
#    1.c. Growing Season Temp Adjustment (GT)
#    1.d. RelLat (RLAT)
#    1.e. RelGT  (RGT)

library(nlme)
path.data <- "../data_processed" 
path.figures <- "../figures_final"
path.hub <- "../data"


# ---------------------------------
# Analysis of latitude trends in budburst
# ---------------------------------
bud.gdd <- read.csv(file.path(path.data, 'First_Budburst_Prediction_Evaluation_all.csv'), stringsAsFactors = T)
leaf.gdd <- read.csv(file.path(path.data, 'First_Leaf_Prediction_Evaluation_all.csv'), stringsAsFactors = T)

bud.lat <- read.csv(file.path(path.data, 'Lat_Budburst_Prediction_Evaluation_all.csv'), stringsAsFactors = T)
leaf.lat <- read.csv(file.path(path.data, 'Lat_Leaf_Prediction_Evaluation_all.csv'), stringsAsFactors = T)
bud.gt <- read.csv(file.path(path.data, 'GTmean_Budburst_Prediction_Evaluation_all.csv'), stringsAsFactors = T)
leaf.gt <- read.csv(file.path(path.data, 'GTmean_Leaf_Prediction_Evaluation_all.csv'), stringsAsFactors = T)

bud.rlat <- read.csv(file.path(path.data, 'Rel_Lat_Budburst_Prediction_Evaluation_all.csv'), stringsAsFactors = T)
leaf.rlat <- read.csv(file.path(path.data, 'Rel_Lat_Leaf_Prediction_Evaluation_all.csv'), stringsAsFactors = T)
bud.rgt <- read.csv(file.path(path.data, 'Rel_GTmean_Budburst_Prediction_Evaluation_all.csv'), stringsAsFactors = T)
leaf.rgt <- read.csv(file.path(path.data, 'Rel_GTmean_Leaf_Prediction_Evaluation_all.csv'), stringsAsFactors = T)


# Simple but statistically inappropriate way of analyzing because ignores dataset structural dependencies (but useful for getting rough idea of patterns)
bud.gdd.lm <- lm(diff ~ latitude*species - latitude - 1, data=bud.gdd)

summary(bud.gdd.lm)
anova(bud.gdd.lm)


# The linear mixed model with random effects is more appropriate, but since we only ahve 1 site for marilandica, we need to omit it from the analysis
library(nlme)
bud.gdd.lme <- lme(diff ~ latitude*species - latitude - 1, random=list(site_id=~1, individual_id=~1), data=bud.gdd[!bud.gdd$species %in% "marilandica",], na.action=na.omit)
summary(bud.gdd.lme)

bud.gdd.lat.sumstat <- data.frame(summary(bud.gdd.lme)$tTable)
bud.gdd.lat.sumstat$Value <- round(bud.gdd.lat.sumstat$Value, 1)
bud.gdd.lat.sumstat$Std.Error <- round(bud.gdd.lat.sumstat$Std.Error, 1)
bud.gdd.lat.sumstat$t.value <- round(bud.gdd.lat.sumstat$t.value, 1)
bud.gdd.lat.sumstat$p.value <- round(bud.gdd.lat.sumstat$p.value, 3)
bud.gdd.lat.sumstat

write.csv(bud.gdd.lat.sumstat, "../data_processed/LatitudeTrends_Budburst_LME_outputput_First.csv", row.names=T)


leaf.gdd.lat.lm <- lm(diff ~ latitude*species - latitude - 1, data=leaf.gdd)

summary(leaf.gdd.lat.lm)
anova(leaf.gdd.lat.lm)

leaf.gdd.lme <- lme(diff ~ latitude*species - latitude - 1, random=list(site_id=~1, individual_id=~1), data=leaf.gdd[!leaf.gdd$species %in% "marilandica",], na.action=na.omit)
summary(leaf.gdd.lme)

leaf.gdd.lat.sumstat <- data.frame(summary(leaf.gdd.lme)$tTable)
leaf.gdd.lat.sumstat$Value <- round(leaf.gdd.lat.sumstat$Value, 1)
leaf.gdd.lat.sumstat$Std.Error <- round(leaf.gdd.lat.sumstat$Std.Error, 1)
leaf.gdd.lat.sumstat$t.value <- round(leaf.gdd.lat.sumstat$t.value, 1)
leaf.gdd.lat.sumstat$p.value <- round(leaf.gdd.lat.sumstat$p.value, 3)
leaf.gdd.lat.sumstat

write.csv(leaf.gdd.lat.sumstat, "../data_processed/LatitudeTrends_LeafOut_LME_outputput_First.csv", row.names=T)

# Evaluating change in slope with the different adjusted 
# # NOTE: need to repeat the Evaluation process for each of the models
# dir(path.data, "Evaluation")
