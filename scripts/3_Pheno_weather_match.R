#----------------------------------------------------------------------------------------------------------------------------------#
# Script by : Lucien Fitzpatrick
# Project: Collection phenology vulnerability
# Purpose: This script serves to combine our weather data with our phenometric data so we can match weather to events
#          Also to visualize our data since it will be our model input
# Inputs: Oak_collection_budburst_raw.csv
#         Oak_collection_leaf_raw.csv
#         GHCN_met_all.csv
# Outputs: dat.budburst data frame containing first budburst event and weather statistics of interest
#          dat.leaf data frame containing first budburst event and weather statistics of interest
#-----------------------------------------------------------------------------------------------------------------------------------#
dat.burst <- read.csv(paste0(path.hub, "/data/Oak_collection_budburst_raw.csv"))
dat.leaf <- read.csv(paste0(path.hub, "/data/Oak_collection_leaf_raw.csv"))
met.all <- read.csv(paste0(path.hub, "/data/GHCN_met_all.csv"))

dir.create("../data_processed/", recursive = T, showWarnings = F)

#Creating a new column in our phenology data frame that takes the date of earliest burst and gives us the cumulative gdd of that date from the met data
dat.burst$GDD5.cum <- met.all$GDD5.cum[match(dat.burst$Date, met.all$Date)]
dat.burst$GDD0.cum <- met.all$GDD0.cum[match(dat.burst$Date, met.all$Date)]
dat.burst$NCD <- met.all$NCD[match(dat.burst$Date, met.all$Date)]
dat.burst$GTmean <- met.all$GTmean[match(dat.burst$Date, met.all$Date)]


dat.leaf$GDD5.cum <- met.all$GDD5.cum[match(dat.leaf$Date, met.all$Date)]
dat.leaf$GDD0.cum <- met.all$GDD0.cum[match(dat.leaf$Date, met.all$Date)]
dat.leaf$NCD <- met.all$NCD[match(dat.leaf$Date, met.all$Date)]
dat.leaf$GTmean <- met.all$GTmean[match(dat.leaf$Date, met.all$Date)]


write.csv(dat.burst, "../data_processed/Oak_collection_budburst.csv", row.names=F)
write.csv(dat.leaf, "../data_processed/Oak_collection_leaf.csv", row.names=F)
